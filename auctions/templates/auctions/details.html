{% extends 'auctions/layout.html'%}

{% block title %}
{{ item.name }}
{% endblock %}

{% block body %}
<div class="container parent">
    <h4>Listing: <span class="title">{{ item.name }}</span></h4>
    <img class="big" src="{{ item.imageUrl }}" alt="{{ item.id }}">
    {{ item.description }}
    <br>
    Start Bid : ${{ item.startBid }}
    <br>
    {% for bid in bids %}
    <div>{{ bid.user.username }} bid <strong>{{ bid.bidValue }}</strong> at {{ bid.date|date:'d M, h:i a' }}</div>
    {% empty %}
    No Bids Yet!
    {% endfor %}

    <div class="my-3">
        {% if messages %}
        {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
        {% endfor %}
        {% endif %}

        {% if item.active %}
        <form action="{% url 'bid' item.id %}" method="post" style="max-width: 600px;">
            {% csrf_token %}
            <input type="hidden" name="user" value="{{ user }}">
            <div class="form-group">
                <input type="number" name="bid" class="form-control" placeholder="Bid" step=".01">
            </div>
            <div class="row justify-content-around">
                <button class="btn btn-primary" type="submit">Place Bid</button>
                {% if item.user.username == user.username %}
                <a href="{% url 'end' item.id user.id %}">
                    <button class="btn btn-warning" type="button">End Auction</button>
                </a>
                {% endif %}
            </div>
        </form>
        {% endif %}
    </div>

    <div class="container">
        Details
        <ul>
            <li>Listed By: {{ item.user.username }}</li>
            <li>Category: {{ item.category.name }}</li>
            <li>Listed On: {{ item.date }}</li>
        </ul>
    </div>

    <div class="m-4 p-4">
        Comments:
        {% for comment in comments %}
        <div class="card">
            <div class="card-body">
                <div class="card-title">
                    Comment by: <strong>{{ comment.user.username }}</strong>
                </div>
                <div class="card-text">
                    {{ comment.commentValue }}
                </div>
                Commented on: <strong>{{ comment.date }}</strong>
            </div>
        </div>
        {% empty %}
        <div class="alert alert-info">
            No Comments Yet
        </div>
        {% endfor %}

        <form action="{% url 'comment' item.id %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                <textarea name="content" rows="5" class="form-control" placeholder="Enter a comment"></textarea>
            </div>
            <input type="hidden" name="user" value="{{ user }}">
            <button class="btn btn-dark py-2 px-4" type="submit">Comment</button>
        </form>
    </div>


</div>
{% endblock %}